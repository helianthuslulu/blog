<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   
   <title>python 编码问题</title>
   
   <meta name="author" content="xiyoulaoyuanjia" />
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <!--   <link href="http://feeds.julianyap.com/julianyap" rel="alternate" title="Julian Yap" type="application/rss+xml" /> -->
   <link href="https://plus.google.com/111539417571342089192" rel="publisher" />
   <link rel="shortcut icon" href="/favicon.ico" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" /> 

   <!-- Homepage CSS -->
 <!--
   <link rel="stylesheet" type="text/css" href="/css/base.css">
   <link rel="stylesheet" type="text/css" href="/css/skeleton.css">
   <link rel="stylesheet" type="text/css" href="/css/layout.css">
   -->
   <link rel="stylesheet" href="../css/syntax.css" type="text/css" /> 

   <!-- Homepage CSS -->
   <link rel="stylesheet" type="text/css" href="../css/base.css">
   <link rel="stylesheet" type="text/css" href="../css/skeleton.css">
   <link rel="stylesheet" type="text/css" href="../css/layout.css">

</head>
<body>

<div class="container">
  <div class="sixteen columns title">
    <a href="/" title="xiyoulaoyuanjia: Home">xiyoulaoyuanjia</a>
  </div>
  
  <div class="eleven columns">
  
<h1>python 编码问题</h1>

<div id="post">
<blockquote><ul>
<li>python 安装时默认的编码方式 为 ascii方式</li>
</ul>
</blockquote>

<pre><code>&gt;&gt;&gt; print sys.getdefaultencoding()
ascii
</code></pre>

<blockquote><ul>
<li>修改默认编码方式
  reload(sys)
  sys.setdefaultencoding('utf8')</li>
</ul>
</blockquote>

<p>注意这里的 reload(sys) 的问题  详细见<a href="https://groups.google.com/forum/?fromgroups=#!topic/comp.lang.python/hUsco3ZvR2s">这里</a></p>

<blockquote><ul>
<li>常见的两种编码方式</li>
</ul>
</blockquote>

<pre><code>&gt;&gt;&gt; "汉字".__class__
&lt;type 'str'&gt;
&gt;&gt;&gt; 
&gt;&gt;&gt; u"汉字".__class__
&lt;type 'unicode'&gt;
&gt;&gt;&gt; 
</code></pre>

<p>str 与 unicode 有什么区别呢？?</p>

<blockquote><ul>
<li>"你好".encode("utf8") 错误的分析</li>
</ul>


<blockquote><blockquote><p>"你好".encode("utf8")</p></blockquote></blockquote></blockquote>

<pre><code>Traceback (most recent call last):
File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe4 in position 0: ordinal not in range(128)
</code></pre>

<p>更完整的关于这个的错误解释见<a href="http://stackoverflow.com/questions/9644099/python-ascii-codec-cant-decode-byte">这里</a></p>

<blockquote><ul>
<li>关于 decode 方法 的使用</li>
</ul>
</blockquote>

<pre><code>&gt;&gt;&gt; "汉字".decode()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe6 in position 0: ordinal not in range(128)
&gt;&gt;&gt; 
</code></pre>

<p>decode 默认会把 "汉字" 转化为 系统编码(因为默认为ascii所以上述会出错)，验证可以更改系统
编码之后在测试上面的</p>

<pre><code>&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.getdefaultencoding()
'ascii'
&gt;&gt;&gt; 
&gt;&gt;&gt; reload(sys)
&lt;module 'sys' (built-in)&gt;
&gt;&gt;&gt; sys.setdefaultencoding('utf8') 
&gt;&gt;&gt; "汉字".decode()
u'\u6c49\u5b57'
&gt;&gt;&gt; 
</code></pre>

<p>如果不想这样子可以直接 "汉字".decode("utf8") 这样子编码</p>

<blockquote><ul>
<li>关于编码转换</li>
</ul>
</blockquote>

<p>一般转换思路为 A编码--》系统编码(Asci或者unicode)--》B编码</p>

<p>因为系统默认编码方式一般是 Ascii所以 对于A编码能不能转化为 ASCII 为关键。而我们知道
编码问题的大多数错误都是在这里出粗了</p>

<p>例如  "你好".encode("utf8")</p>

<p>按上述转换思路可以看出 "你好".decode().encode("utf8")</p>

<p>"你好" 的编码有外部文本环境决定 例如 # -<em>- coding: utf-8 -</em>-  则 编码为 utf8
而此时系统编码为 默认的ASCii  所以第一步 utf8--》 ASii 编码 肯定会错误的。。</p>

<p>这里写了一个通用的转换代码</p>

<pre><code>#!/usr/bin/env python 
#coding=utf-8 
s="中文" 
if isinstance(s, unicode):  
print s.encode('gb2312') 
else: 
print s.decode('utf-8').encode('gb2312')
</code></pre>

<p>这里编码已gb2321 为例子</p>

</div>

<div>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="jyap" data-size="large">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>

<div align="right" class="date-container">16 APRIL 2013 @ 04:29AM</div>

<div id="related">
  <h1>Related Posts</h1>
  <ul class="posts">
    
      <li><span class="post_date">21 Apr 2013</span> &raquo; <a href="/2013/04/21/%E4%BD%BF%E7%94%A8ajax%E4%B8%8A%E4%BC%A0%E6%96%87%E6%A1%A3.html">使用ajax上传文档</a></li>
    
      <li><span class="post_date">16 Apr 2013</span> &raquo; <a href="/2013/04/16/python-%E4%B8%AD-sqlite3-%E7%9A%84%E4%BD%BF%E7%94%A8.html">python 中 sqlite3 的使用</a></li>
    
      <li><span class="post_date">16 Apr 2013</span> &raquo; <a href="/2013/04/16/cookies-and-%E7%BC%93%E5%AD%98.html">cookies and 缓存</a></li>
    
  </ul>
</div>


  </div>
  <div class="four columns offset-by-one">
  <h1>Pages</h1>
  <ul class="posts">
    <li><a href="/pages/about.html">About</a></li>
    <li><a href="/pages/archives.html">Archives</a></li>
    <li><a href="/pages/projects.html">Projects</a></li>
  </ul>
  <!-- AddThis Button BEGIN -->
  <h1>Follow Me</h1>
  <div class="addthis_toolbox addthis_32x32_style addthis_vertical_style">
  <a class="addthis_button_twitter_follow" addthis:userid="jyap_no"></a>
  <a class="addthis_button_google_follow" addthis:userid="111539417571342089192_no"></a>
  <a class="addthis_button_rss_follow" addthis:url="http://feeds.julianyap.com/julianyap_no"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4f30f5735bbf9458"></script>
  <!-- AddThis Button END -->
  </div>

  <div class="sixteen columns footer">
    <div class="contact">
      <p>
        Copyright © xiyoulaoyuanjia1 now
      </p>
    </div>
    <div>
      <p>
	   Follow Julian: <a href="http://twitter.com/jyap">Twitter</a> / <a href="https://plus.google.com/111539417571342089192/" rel="author">Google+</a> / <a href="http://feeds.julianyap.com/julianyap">RSS</a>  
      </p>
    </div>
  </div>
</div>
<!-- Analytics -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://www2.julianyap.com/stats/" : "http://www2.julianyap.com/stats/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://www2.julianyap.com/stats/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>


</body>
</html>
